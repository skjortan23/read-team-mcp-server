#!/usr/bin/env python3
"""
Setup script for populating the Metasploit exploits database.

This script is a simple wrapper around the populate_exploits.py module
that can be run from the project root to set up the exploits database.
"""

import sys
import os

# Add the src directory to the Python path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'src'))

from red_team_mcp.populate_exploits import populate_exploits_database


def main():
    """Main setup function."""
    print("üöÄ Red Team MCP - Exploits Database Setup")
    print("=" * 50)
    print()
    
    print("This script will populate the MongoDB exploits database with")
    print("detailed information about all available Metasploit exploits.")
    print()
    print("Prerequisites:")
    print("- Metasploit Framework installed")
    print("- Metasploit RPC server running (msfrpcd -P msf -a 127.0.0.1)")
    print("- MongoDB running on localhost:27017")
    print("- pymetasploit3 Python library installed")
    print()
    
    # Ask for confirmation
    response = input("Do you want to continue? (y/N): ").strip().lower()
    if response not in ['y', 'yes']:
        print("Setup cancelled.")
        return
    
    print()
    print("Starting exploit database population...")
    print("This may take several minutes depending on the number of exploits.")
    print()
    
    # Run the population
    result = populate_exploits_database(clear_existing=True, batch_size=50)
    
    print()
    print("=" * 50)
    
    if result["success"]:
        print("‚úÖ Setup completed successfully!")
        print()
        print(f"üìä Exploits processed: {result['exploits_processed']}")
        print(f"üíæ Exploits saved: {result['exploits_saved']}")
        print(f"‚ùå Failed: {result['exploits_failed']}")
        print(f"‚è±Ô∏è  Duration: {result['duration_seconds']:.2f} seconds")
        print()
        print("You can now use the 'search_exploits_fast' tool for fast exploit searches!")
        print()
        print("Example usage:")
        print("- Search Windows SMB exploits: search_exploits_fast(platform='windows', search_term='smb')")
        print("- Find EternalBlue: search_exploits_fast(cve='CVE-2017-0144')")
        print("- High-quality exploits: search_exploits_fast(rank='excellent')")
    else:
        print("‚ùå Setup failed!")
        print(f"Error: {result['error']}")
        print()
        print("Please check:")
        print("- Metasploit RPC server is running: msfrpcd -P msf -a 127.0.0.1")
        print("- MongoDB is running on localhost:27017")
        print("- pymetasploit3 is installed: pip install pymetasploit3")


if __name__ == "__main__":
    main()
